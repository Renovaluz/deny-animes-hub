<style>
    /* ==========================================================================
       ESTILOS DA PÁGINA DE PERFIL - VERSÃO FINAL AKATSUKI
    ========================================================================== */

    .profile-header {
        position: relative; height: 380px; background-size: cover; background-position: center;
        display: flex; align-items: flex-end; padding: 2rem 2.5rem; color: #fff;
    }
    .profile-header-overlay {
        position: absolute; inset: 0;
        background: linear-gradient(to top, rgba(var(--bg-primary-rgb), 1) 10%, rgba(var(--bg-primary-rgb), 0.7) 50%, transparent 100%);
    }
    .profile-header-content {
        position: relative; z-index: 2; display: flex; align-items: flex-end;
        gap: 24px; width: 100%; max-width: 1280px; margin: 0 auto;
    }
    .profile-avatar {
        width: 160px; height: 160px; border-radius: 50%; border: 5px solid var(--bg-secondary);
        box-shadow: 0 0 0 2px var(--accent-primary), var(--shadow-md); object-fit: cover; flex-shrink: 0;
    }
    .profile-user-info h1 { font-size: 2.8rem; font-weight: 700; margin-bottom: 0.25rem; text-shadow: 2px 2px 5px rgba(0,0,0,0.7); }
    .profile-role {
        display: inline-block; padding: 5px 15px; border-radius: 50px; font-size: 0.9rem;
        font-weight: 600; background-color: var(--accent-primary); color: #fff; margin-bottom: 0.75rem;
    }
    .profile-join-date { font-size: 0.9rem; color: #e0e0e0; opacity: 0.9; }
    .profile-header-actions { position: absolute; top: 1.5rem; right: 1.5rem; display: flex; gap: 1rem; }
    .profile-header-actions .btn { backdrop-filter: blur(5px); background-color: rgba(var(--bg-secondary-rgb), 0.5); }
    
    .profile-grid-layout { display: grid; grid-template-columns: 320px 1fr; gap: 32px; padding-top: 40px; padding-bottom: 60px; }
    .profile-widget { background-color: var(--bg-secondary); padding: 30px; border-radius: var(--border-radius-lg); border: 1px solid var(--border-color); margin-bottom: 32px; box-shadow: var(--shadow-md); }
    .profile-widget h3 { margin: 0 0 24px 0; padding-bottom: 12px; font-size: 1.5rem; font-weight: 600; display: flex; align-items: center; border-bottom: 2px solid var(--accent-primary); }
    .profile-widget h3 i { margin-right: 14px; color: var(--accent-primary); font-size: 1.3rem; }
    .profile-bio { color: var(--text-secondary); }
    
    /* --- ESTILOS DO CARROSSEL "CONTINUAR ASSISTINDO" --- */
    #continue-watching-container {
        display: flex; overflow-x: auto; gap: 20px;
        padding: 5px 5px 20px 5px; margin: 0 -5px;
        scrollbar-color: var(--accent-primary) var(--bg-tertiary); scrollbar-width: thin;
    }
    #continue-watching-container::-webkit-scrollbar { height: 10px; }
    #continue-watching-container::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 10px; }
    #continue-watching-container::-webkit-scrollbar-thumb { background-color: var(--accent-primary); border-radius: 10px; border: 2px solid var(--bg-tertiary); }
    
    .episode-item {
        flex: 0 0 280px; border-radius: var(--border-radius-md); overflow: hidden;
        background-color: var(--bg-tertiary); border: 1px solid var(--border-color);
        box-shadow: var(--shadow-md); transition: all 0.3s ease;
    }
    .episode-item:hover { transform: translateY(-8px) scale(1.02); box-shadow: var(--shadow-lg), var(--shadow-glow); }
    .episode-link { display: block; text-decoration: none; position: relative; }
    .episode-thumbnail { width: 100%; height: 158px; object-fit: cover; display: block; }
    .episode-play-icon {
        position: absolute; top: calc(158px / 2); left: 50%;
        transform: translate(-50%, -50%) scale(0); font-size: 4rem; color: #fff;
        background-color: rgba(var(--accent-primary-rgb), 0.7); backdrop-filter: blur(4px);
        border-radius: 50%; padding: 1rem; opacity: 0; transition: all 0.3s ease; pointer-events: none;
    }
    .episode-item:hover .episode-play-icon { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    
    .episode-info { padding: 12px 14px; }
    .episode-anime-name, .episode-number { display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .episode-anime-name { font-weight: 600; color: var(--text-primary); font-size: 1rem; }
    .episode-number { font-size: 0.85rem; color: var(--text-secondary); }
    
    .progress-bar { height: 6px; background-color: rgba(var(--accent-primary-rgb), 0.2); margin-top: 8px; border-radius: 3px; }
    .progress-bar-inner { height: 100%; background-color: var(--accent-primary); border-radius: 3px; width: 0%; transition: width 0.5s ease; }

    /* Placeholder e Loader */
    .history-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem; width: 100%; min-height: 220px; color: var(--text-secondary); border: 2px dashed var(--border-color); border-radius: var(--border-radius); background-color: var(--bg-primary); }
    .history-placeholder.loading .fa-spinner { display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; }
    .history-placeholder.loading span { display: none; }
    .history-placeholder .fa-spinner { display: none; }

    @media (max-width: 992px) { .profile-grid-layout { grid-template-columns: 1fr; } }
    @media (max-width: 768px) { /* ... outros estilos responsivos ... */ }
</style>
<div class="profile-page-container animated-section fade-in">
    <!-- Profile Header com Capa -->
    <header class="profile-header" style="background-image: url('<%= user.capaPerfil %>');">
        <div class="profile-header-overlay"></div>
        <div class="profile-header-content">
            <div class="profile-avatar-container">
                <img src="<%= user.avatar || '/images/avatar_padrao.png' %>" alt="Avatar de <%= user.nome %>" class="profile-avatar">
            </div>
            <div class="profile-user-info">
                <h1><%= user.nome %></h1>
                <p class="profile-role"><%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %></p>
                <p class="profile-join-date">Membro desde <%= new Date(user.createdAt).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long' }) %></p>
            </div>
            
            <div class="profile-header-actions">
                <a href="/perfil/editar" class="btn btn--secondary profile-edit-btn"><i class="fas fa-pencil-alt"></i> Editar Perfil</a>
                <% if(user.role === 'admin') { %>
                    <a href="/admin/dashboard" class="btn btn--primary profile-admin-btn"><i class="fas fa-user-shield"></i> Dashboard</a>
                <% } %>
            </div>
        </div>
    </header>

    <div class="profile-grid-layout container">
        <aside class="profile-sidebar">
            <div class="profile-widget">
                <h3><i class="fas fa-address-card"></i> Sobre Mim</h3>
                <p class="profile-bio"><%= user.bio %></p>
            </div>
        </aside>

        <main class="profile-main-content">
            <div class="profile-widget">
                <h3><i class="fas fa-history"></i> Continuar Assistindo</h3>
                
                <!-- CONTAINER DINÂMICO PARA O HISTÓRICO -->
                <div id="history-container-wrapper">
                    <!-- Placeholder de Carregamento -->
                    <div id="history-placeholder" class="history-placeholder loading">
                        <i class="fas fa-spinner"></i>
                        <span>Carregando seu histórico...</span>
                    </div>
                    <!-- O Carrossel será inserido aqui pelo JavaScript -->
                </div>

            </div>
        </main>
    </div>
    </div>