<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akatsuki Hub | Central de Mídia Profissional</title>

<!-- Google Fonts: Poppins -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Estilos Principais -->
<style>
    /*
    ================================================================
    DESIGN SYSTEM V5: "AKATSUKI ELITE"
    - Retorno ao tema Akatsuki com execução premium e sofisticada.
    - Foco em UI/UX, legibilidade e organização estrutural.
    - Layout responsivo mobile-first com sidebar sticky.
    - Modal único e inteligente para todos os tipos de conteúdo.
    ================================================================
    */

    :root {
        /* MODO ESCURO (PADRÃO) */
        --font-family-main: 'Poppins', sans-serif;
        --color-primary: #E50914; /* Vermelho Akatsuki */
        --color-primary-hover: #F40612;
        
        --color-background: #0A0A0A;
        --color-surface: #141414;
        --color-surface-light: #1F1F1F;
        --color-border: rgba(255, 255, 255, 0.1);
        
        --color-text-primary: #EAEAEA;
        --color-text-secondary: #A0A0A0;
        --color-text-heading: #FFFFFF;

        --shadow-medium: 0 8px 16px rgba(0, 0, 0, 0.3);
        --shadow-large: 0 15px 30px rgba(0, 0, 0, 0.5);
        --modal-backdrop-color: rgba(10, 10, 10, 0.7);
    }

    body.light-mode {
        /* MODO CLARO */
        --color-primary: #D90429;
        --color-primary-hover: #B90022;

        --color-background: #F8F9FA;
        --color-surface: #FFFFFF;
        --color-surface-light: #F1F3F5;
        --color-border: #DEE2E6;

        --color-text-primary: #343A40;
        --color-text-secondary: #6C757D;
        --color-text-heading: #000000;

        --shadow-medium: 0 8px 16px rgba(0, 0, 0, 0.08);
        --shadow-large: 0 15px 30px rgba(0, 0, 0, 0.12);
        --modal-backdrop-color: rgba(248, 249, 250, 0.5);
    }
    
    /* RESET E CONFIGURAÇÕES GLOBAIS */
    *, *::before, *::after { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    
    body {
        font-family: var(--font-family-main);
        background-color: var(--color-background);
        color: var(--color-text-primary);
        margin: 0;
        padding-top: 70px;
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.modal-open { overflow: hidden; }

    .container {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 30px;
    }

    /* HEADER E NAVEGAÇÃO */
    .main-header {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 70px;
        background-color: rgba(10, 10, 10, 0.8);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--color-border);
        z-index: 900;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    body.light-mode .main-header { background-color: rgba(255, 255, 255, 0.8); }
    
    .main-header .container { display: flex; align-items: center; justify-content: center; height: 100%; }
    
    .header-logo {
        font-size: 1.6rem; font-weight: 700;
        color: var(--color-text-heading); text-decoration: none;
    }
    .header-logo .fa-cloud { color: var(--color-primary); }

    /* LAYOUT PRINCIPAL */
    .main-layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 40px;
        padding: 40px 0;
    }
    @media (min-width: 992px) {
        .main-layout { grid-template-columns: 1fr 340px; }
    }

    .main-content-area > section:not(:last-child) { margin-bottom: 50px; }
    .section-title {
        font-size: 2rem; font-weight: 600; color: var(--color-text-heading);
        margin: 0 0 25px 0; padding-bottom: 15px;
        border-bottom: 2px solid var(--color-primary);
        display: flex; align-items: center; gap: 12px;
    }

    /* GRID DE NOTÍCIAS */
    .news-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
    }
    @media (min-width: 768px) { .news-grid { grid-template-columns: repeat(2, 1fr); } }

    .news-card {
        background-color: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        text-decoration: none;
        color: inherit;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        display: flex; flex-direction: column;
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
    }
    .news-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-medium); border-color: var(--color-primary); }

    .news-card__image-container { position: relative; aspect-ratio: 16 / 9; overflow: hidden; }
    .news-card__image { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
    .news-card:hover .news-card__image { transform: scale(1.05); }

    .news-card__content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
    .news-card__category {
        font-size: 0.75rem; font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .news-card__title {
        font-size: 1.25rem; font-weight: 600;
        color: var(--color-text-heading);
        line-height: 1.4;
        margin: 0;
        flex-grow: 1;
    }
    .news-card__excerpt {
        font-size: 0.9rem;
        color: var(--color-text-secondary);
        margin-top: 10px;
        line-height: 1.6;
    }
    .news-card__meta {
        font-size: 0.8rem;
        color: var(--color-text-secondary);
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid var(--color-border);
    }
    .news-card__meta span { display: inline-flex; align-items: center; gap: 8px; }

    /* SIDEBAR (STICKY E COM SCROLL INTERNO) */
    .sidebar { position: relative; }
    .sidebar-inner { position: sticky; top: 90px; }
    .sidebar-widget {
        background-color: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 25px;
        max-height: calc(100vh - 110px);
        overflow-y: auto;
    }
    
    .ranking-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 15px; }
    .ranking-item a {
        display: flex; gap: 15px; align-items: center;
        padding: 10px; border-radius: 6px;
        transition: background-color 0.2s ease;
        text-decoration: none;
    }
    .ranking-item a:hover { background-color: var(--color-surface-light); }
    .ranking-item__img { width: 50px; height: 75px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
    .ranking-item__info { flex-grow: 1; }
    .ranking-item__title { font-weight: 600; color: var(--color-text-primary); margin-bottom: 5px; line-height: 1.3; }
    .ranking-item__meta { font-size: 0.85rem; color: var(--color-text-secondary); }
    .ranking-item__meta .fa-star { color: #f5c518; }
    
    /* MODAL ÚNICO E INTELIGENTE */
    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: var(--modal-backdrop-color);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        display: flex; align-items: center; justify-content: center;
        opacity: 0; visibility: hidden;
        transition: opacity 0.4s ease, visibility 0s 0.4s;
        z-index: 1000;
        padding: 20px;
    }
    .modal.is-active { opacity: 1; visibility: visible; transition-delay: 0s; }
    
    .modal__content {
        background-color: transparent;
        border-radius: 12px;
        width: 100%; max-width: 1100px;
        height: 90vh; max-height: 850px;
        transform: scale(0.95); opacity: 0;
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
        position: relative;
        display: flex;
    }
    .modal.is-active .modal__content { transform: scale(1); opacity: 1; }

    .modal-background {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        object-fit: cover; z-index: 1; border-radius: inherit;
    }
    .modal-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(to top, rgba(10, 10, 10, 0.95) 30%, rgba(10, 10, 10, 0.7) 100%);
        z-index: 2; border-radius: inherit;
    }
    body.light-mode .modal-overlay {
        background: linear-gradient(to top, rgba(248, 249, 250, 0.95) 30%, rgba(248, 249, 250, 0.7) 100%);
    }

    .modal__close {
        position: absolute; top: 15px; right: 15px;
        background: rgba(0,0,0,0.3); border: 1px solid transparent;
        border-radius: 50%; width: 40px; height: 40px;
        font-size: 1rem; color: #fff; cursor: pointer;
        transition: all 0.3s ease;
        display: flex; align-items: center; justify-content: center;
        z-index: 4;
    }
    .modal__close:hover { background: var(--color-primary); transform: scale(1.1) rotate(90deg); }

    .modal-inner-wrapper {
        position: relative; z-index: 3;
        width: 100%; height: 100%;
        overflow-y: auto;
        padding: 40px;
    }
    
    .modal-header { text-align: center; margin-bottom: 30px; }
    .modal-header__title {
        font-size: 2.8rem; font-weight: 700;
        color: var(--color-text-heading);
        line-height: 1.2;
        text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    
    #modal-main-content { margin-bottom: 40px; }
    .video-player-container {
        position: relative; width: 100%; padding-bottom: 56.25%; height: 0;
        border-radius: 8px; overflow: hidden;
        background-color: #000; box-shadow: var(--shadow-large);
    }
    .video-player-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    
    .article-body-container {
        background: rgba(0,0,0,0.2);
        padding: 30px;
        border-radius: 8px;
        font-size: 1.1rem; line-height: 1.8;
    }
    .article-body-container p { margin: 0 0 1.5em; }
    
    .modal-comments-section {
        border-top: 1px solid var(--color-border);
        padding-top: 30px;
    }
    .comments-section-title { font-size: 1.5rem; margin: 0 0 20px 0; }
    .comment-form { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
    .comment-form textarea {
        width: 100%; min-height: 100px; padding: 15px;
        border: 1px solid var(--color-border); border-radius: 6px;
        background-color: var(--color-surface-light); color: var(--color-text-primary);
        font-family: inherit; font-size: 1rem; resize: vertical;
        transition: all 0.2s ease;
    }
    .comment-form textarea:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.2); outline: none; }
    .comment-form-footer { text-align: right; }
    
    .comments-list { display: flex; flex-direction: column; gap: 20px; }
    .comment-card { display: flex; gap: 15px; }
    .comment-card__avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
    .comment-card__body { flex-grow: 1; }
    .comment-card__author { font-weight: 600; color: var(--color-text-primary); }
    .comment-card__date { font-size: 0.8rem; color: var(--color-text-secondary); margin-left: 10px; }
    .comment-card__text { margin-top: 5px; line-height: 1.6; }

    /* UTILITÁRIOS */
    .status-message { padding: 40px 20px; text-align: center; color: var(--color-text-secondary); font-size: 1.1rem; }
    .scrollbar-styled { scrollbar-width: thin; scrollbar-color: var(--color-primary) var(--color-surface-light); }
    .scrollbar-styled::-webkit-scrollbar { width: 8px; }
    .scrollbar-styled::-webkit-scrollbar-track { background: transparent; }
    .scrollbar-styled::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: 4px; }

    /* FOOTER */
    .main-footer {
        background-color: var(--color-surface);
        padding: 30px 0; text-align: center;
        color: var(--color-text-secondary); font-size: 0.9rem;
    }
    #theme-toggle-btn-footer {
        background: none; border: none; font-size: 1.2rem;
        color: var(--color-text-secondary); cursor: pointer; margin-left: 15px;
        vertical-align: middle;
    }
</style>
</head>
<body>

<!-- HEADER PRINCIPAL -->
<header class="main-header">
    <div class="container">
        <a href="#" class="header-logo">
            <i class="fas fa-cloud"></i> Akatsuki Hub
        </a>
    </div>
</header>

<!-- LAYOUT PRINCIPAL DO CONTEÚDO -->
<div class="container main-layout">
    <main class="main-content-area">
        <section id="admin-news-section">
            <h2 class="section-title"><i class="fas fa-user-edit"></i> Artigos do Editor</h2>
            <div class="news-grid" id="admin-news-grid">
                <!-- Cards de notícias do admin serão injetados aqui -->
            </div>
        </section>
        <section id="api-news-section">
            <h2 class="section-title"><i class="fas fa-film"></i> Destaques da Web</h2>
            <div class="news-grid" id="api-news-grid">
                <!-- Cards de notícias da API serão injetados aqui -->
            </div>
        </section>
    </main>
    
    <aside class="sidebar">
        <div class="sidebar-inner">
            <div class="sidebar-widget scrollbar-styled">
                <section id="top-animes-widget">
                    <h3 class="section-title"><i class="fas fa-fire-alt"></i> Top Animes</h3>
                    <ol class="ranking-list" id="top-anime-list"></ol>
                </section>
            </div>
        </div>
    </aside>
</div>

<!-- MODAL ÚNICO E INTELIGENTE -->
<div id="content-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal__content">
        <img id="modal-backdrop" src="" alt="Fundo dinâmico" class="modal-background">
        <div class="modal-overlay"></div>
        <button class="modal__close" aria-label="Fechar modal">×</button>
        <div class="modal-inner-wrapper scrollbar-styled">
            <header class="modal-header">
                <h2 id="modal-title" class="modal-header__title">Carregando...</h2>
            </header>
            <main id="modal-main-content"></main>
            <section class="modal-comments-section">
                <h3 class="comments-section-title">Comentários da Comunidade</h3>
                <form id="comment-form" class="comment-form">
                    <textarea placeholder="Deixe seu comentário..." required></textarea>
                    <div class="comment-form-footer">
                        <button type="submit" class="btn btn--primary"><i class="fas fa-paper-plane"></i> Enviar</button>
                    </div>
                </form>
                <div id="comments-list" class="comments-list"></div>
            </section>
            <section id="youtube-comments-section" class="modal-comments-section" style="display:none;">
                 <h3 class="comments-section-title">Comentários do YouTube</h3>
                 <div id="youtube-comments-list" class="comments-list"></div>
            </section>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="main-footer">
    <p>© 2025 Akatsuki Hub.
        <button id="theme-toggle-btn-footer" aria-label="Alternar tema">
            <i class="fas fa-moon theme-icon"></i>
            <i class="fas fa-sun theme-icon"></i>
        </button>
    </p>
</footer>

<script>
/**
 * @file Script principal para o Akatsuki Hub v5.
 * @description Versão com design "Akatsuki Elite", modal único inteligente,
 * e arquitetura JS modular para uma experiência robusta e profissional.
 * @version 5.0.0
 */

const App = {
    // -------------------------------------------------------------------------
    // 1. CONFIGURAÇÃO E ESTADO
    // -------------------------------------------------------------------------
    config: {
        JIKAN_API: 'https://api.jikan.moe/v4',
        YOUTUBE_API_KEY: 'SUA_CHAVE_API_DO_YOUTUBE_AQUI',
        YOUTUBE_API_URL: 'https://www.googleapis.com/youtube/v3',
        PLACEHOLDER_IMG: 'https://via.placeholder.com/500x281/141414/A0A0A0?text=Indisponível',
    },

    state: {
        currentContentId: null, // Será 'video_{id}' ou 'article_{id}'
    },
    
    // Conteúdo estático simulando notícias do admin
    adminPosts: [{
        id: 'article_1',
        type: 'article',
        category: 'Análise',
        title: 'A Relevância Contínua de Cowboy Bebop',
        author: 'O Editor',
        date: '2025-07-15',
        image: 'https://images.alphacoders.com/605/605592.png',
        excerpt: 'Explorando como a mistura de gêneros, personagens profundos e trilha sonora icônica mantém a obra-prima de Shinichirō Watanabe atemporal.',
        content: `<p>Vinte e sete anos após sua estreia, Cowboy Bebop transcende a nostalgia para se afirmar como uma das obras mais influentes e artisticamente completas da história da animação. Sua genialidade não reside em um único elemento, mas na fusão quase perfeita de faroeste espacial, filme noir, comédia e um jazz melancólico que dá alma à jornada de sua tripulação.</p><p>Cada episódio é uma vinheta, uma história contida que explora temas de existencialismo, solidão e a impossibilidade de escapar do passado. Spike, Jet, Faye e Ed não são heróis; são sobreviventes, cada um carregando um fardo que define suas ações. É essa humanidade falha, essa busca por algo indefinido enquanto se lida com as contas do ontem, que cria uma conexão tão duradoura com o público. A série nos ensina que, às vezes, o importante não é encontrar um final feliz, mas sim viver o momento, mesmo que seja apenas até a próxima caçada. See you, Space Cowboy...</p>`
    },
    {
        id: 'article_2',
        type: 'article',
        category: 'Tecnologia',
        title: 'O Futuro da Animação: IA e a Criatividade Humana',
        author: 'O Editor',
        date: '2025-07-14',
        image: 'https://images2.alphacoders.com/133/1335359.png',
        excerpt: 'A inteligência artificial generativa está remodelando indústrias. Como a animação pode se beneficiar sem perder sua alma artística?',
        content: `<p>A ascensão das ferramentas de inteligência artificial generativa de imagem e vídeo provocou um debate acalorado na comunidade artística. Para a indústria da animação, tradicionalmente intensiva em mão de obra, a promessa de otimização é tentadora. A IA pode acelerar processos como a criação de cenários, a interpolação de quadros (in-betweening) e até mesmo a geração de storyboards iniciais.</p><p>No entanto, a preocupação é legítima: onde fica a mão do artista? A beleza da animação muitas vezes reside nas imperfeições deliberadas, no estilo único de um diretor ou de um estúdio. O desafio para o futuro não será substituir os artistas, mas sim criar um pipeline onde a IA atue como uma ferramenta poderosa sob o controle criativo humano. Imagine animadores focando mais na performance dos personagens e na direção de arte, enquanto a IA cuida das tarefas repetitivas. Se bem implementado, este pode ser um salto quântico em produtividade, permitindo que estúdios menores compitam com grandes produções e que novas formas de expressão visual surjam.</p>`
    }],
    
    // -------------------------------------------------------------------------
    // 2. INICIALIZAÇÃO
    // -------------------------------------------------------------------------
    init() {
        this.cacheDOMElements();
        this.ThemeManager.init();
        this.setupEventListeners();
        this.loadInitialContent();
    },

    cacheDOMElements() {
        this.dom = {
            body: document.body,
            adminNewsGrid: document.getElementById('admin-news-grid'),
            apiNewsGrid: document.getElementById('api-news-grid'),
            topAnimeList: document.getElementById('top-anime-list'),
            modal: document.getElementById('content-modal'),
            modalBackdrop: document.getElementById('modal-backdrop'),
            modalTitle: document.getElementById('modal-title'),
            modalMainContent: document.getElementById('modal-main-content'),
            modalCommentsSection: document.querySelector('.modal-comments-section'),
            commentForm: document.getElementById('comment-form'),
            commentsList: document.getElementById('comments-list'),
            youtubeCommentsSection: document.getElementById('youtube-comments-section'),
            youtubeCommentsList: document.getElementById('youtube-comments-list'),
            themeToggleButtons: [document.getElementById('theme-toggle-btn-footer')],
        };
    },

    // -------------------------------------------------------------------------
    // 3. GERENCIAMENTO DE EVENTOS
    // -------------------------------------------------------------------------
    setupEventListeners() {
        this.dom.themeToggleButtons.forEach(btn => btn.addEventListener('click', () => this.ThemeManager.toggle()));
        
        // Delegação de eventos para abrir modal a partir de qualquer card
        document.querySelector('.main-content-area').addEventListener('click', e => this.handleCardClick(e));
        
        // Fechar Modal
        this.dom.modal.querySelector('.modal__close').addEventListener('click', () => this.ModalManager.close());
        this.dom.modal.addEventListener('click', e => {
            if (e.target === this.dom.modal) this.ModalManager.close();
        });
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && this.dom.modal.classList.contains('is-active')) this.ModalManager.close();
        });
        
        // Formulário de Comentário
        this.dom.commentForm.addEventListener('submit', e => this.CommentManager.handleSubmit(e));
    },

    // -------------------------------------------------------------------------
    // 4. CARREGAMENTO DE CONTEÚDO
    // -------------------------------------------------------------------------
    async loadInitialContent() {
        this.render.setLoadingState(this.dom.adminNewsGrid, true);
        this.render.setLoadingState(this.dom.apiNewsGrid, true);
        this.render.setLoadingState(this.dom.topAnimeList, true);

        // Renderiza notícias do admin (estáticas)
        this.render.setLoadingState(this.dom.adminNewsGrid, false);
        this.render.newsGrid(this.adminPosts, this.dom.adminNewsGrid);

        // Carrega notícias da API (vídeos)
        const newsData = await this.Api.getJikanPromos();
        this.render.setLoadingState(this.dom.apiNewsGrid, false);
        if (newsData) this.render.newsGrid(newsData.slice(0, 4), this.dom.apiNewsGrid);

        // Carrega Top Animes
        const animes = await this.Api.getJikanTopAiring();
        this.render.setLoadingState(this.dom.topAnimeList, false);
        if(animes) this.render.sidebarList(this.dom.topAnimeList, animes);
    },

    // -------------------------------------------------------------------------
    // 5. MANIPULADORES DE EVENTOS
    // -------------------------------------------------------------------------
    handleCardClick(event) {
        const card = event.target.closest('.news-card');
        if (!card) return;
        event.preventDefault();

        const { id, type, title, image, excerpt, author, date } = card.dataset;
        this.state.currentContentId = id;

        if (type === 'video') {
            this.ModalManager.open({
                id, type, title, image
            });
        } else if (type === 'article') {
            const articleData = this.adminPosts.find(p => p.id === id);
            this.ModalManager.open({
                ...articleData
            });
        }
    },

    // -------------------------------------------------------------------------
    // 6. GERENCIADORES (MODAL, TEMA, COMENTÁRIOS)
    // -------------------------------------------------------------------------
    ModalManager: {
        open(data) {
            App.dom.body.classList.add('modal-open');
            App.dom.modal.classList.add('is-active');
            
            App.dom.modalBackdrop.src = data.image || '';
            App.dom.modalTitle.textContent = data.title || 'Carregando...';

            if (data.type === 'video') {
                App.render.videoModalLayout(data);
                App.CommentManager.load(data.id);
                App.Api.getYouTubeComments(data.id.split('_')[1]); // Passa apenas o ID do vídeo
            } else if (data.type === 'article') {
                App.render.articleModalLayout(data);
                App.CommentManager.load(data.id);
            }
        },
        close() {
            App.dom.body.classList.remove('modal-open');
            App.dom.modal.classList.remove('is-active');
            // Limpa o conteúdo para a próxima abertura
            App.dom.modalMainContent.innerHTML = '';
            App.dom.youtubeCommentsSection.style.display = 'none';
        },
    },

    ThemeManager: {
        init() {
            if (localStorage.getItem('theme') === 'light') {
                App.dom.body.classList.add('light-mode');
            }
            this.updateIcons();
        },
        toggle() {
            App.dom.body.classList.toggle('light-mode');
            localStorage.setItem('theme', App.dom.body.classList.contains('light-mode') ? 'light' : 'dark');
            this.updateIcons();
        },
        updateIcons() {
            const isLight = App.dom.body.classList.contains('light-mode');
            App.dom.themeToggleButtons.forEach(btn => {
                const moon = btn.querySelector('.fa-moon');
                const sun = btn.querySelector('.fa-sun');
                if (moon && sun) {
                    moon.style.display = isLight ? 'none' : 'block';
                    sun.style.display = isLight ? 'block' : 'none';
                }
            });
        }
    },

    CommentManager: {
        load(contentId) {
            const comments = this.get(contentId);
            App.render.comments(App.dom.commentsList, comments, 'Nenhum comentário da comunidade ainda.');
        },
        get(contentId) {
            try { return JSON.parse(localStorage.getItem(`comments_${contentId}`)) || []; }
            catch { return []; }
        },
        add(contentId, comment) {
            const comments = this.get(contentId);
            comments.unshift(comment);
            localStorage.setItem(`comments_${contentId}`, JSON.stringify(comments));
        },
        handleSubmit(event) {
            event.preventDefault();
            const textarea = event.target.querySelector('textarea');
            const text = textarea.value.trim();
            if (!text || !App.state.currentContentId) return;
            
            const newComment = {
                author: 'Visitante',
                date: new Date().toISOString(),
                text: text,
            };

            this.add(App.state.currentContentId, newComment);
            this.load(App.state.currentContentId);
            textarea.value = '';
        }
    },

    // -------------------------------------------------------------------------
    // 7. CHAMADAS DE API
    // -------------------------------------------------------------------------
    Api: {
        async fetch(url) {
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error(`API Error: ${res.status}`);
                return await res.json();
            } catch (error) { console.error(`Falha ao buscar de ${url}:`, error); return null; }
        },
        async getJikanPromos() { return (await this.fetch(App.config.JIKAN_API + '/watch/promos'))?.data; },
        async getJikanTopAiring() { return (await this.fetch(App.config.JIKAN_API + '/top/anime?filter=airing&limit=5'))?.data; },
        async getYouTubeComments(videoId) {
            App.dom.youtubeCommentsSection.style.display = 'block';
            App.dom.youtubeCommentsList.innerHTML = App.render.getLoadingHTML();
            if (!App.config.YOUTUBE_API_KEY || App.config.YOUTUBE_API_KEY === 'SUA_CHAVE_API_DO_YOUTUBE_AQUI') {
                App.render.comments(App.dom.youtubeCommentsList, [], 'API do YouTube não configurada.');
                return;
            }
            const url = `${App.config.YOUTUBE_API_URL}/commentThreads?part=snippet&videoId=${videoId}&key=${App.config.YOUTUBE_API_KEY}&order=relevance&maxResults=10`;
            const data = await this.fetch(url);
            
            if (data?.items) {
                const comments = data.items.map(item => ({
                    author: item.snippet.topLevelComment.snippet.authorDisplayName,
                    avatar: item.snippet.topLevelComment.snippet.authorProfileImageUrl,
                    date: item.snippet.topLevelComment.snippet.publishedAt,
                    text: item.snippet.topLevelComment.snippet.textDisplay
                }));
                 App.render.comments(App.dom.youtubeCommentsList, comments, 'Nenhum comentário no YouTube.');
            } else {
                 App.render.comments(App.dom.youtubeCommentsList, [], 'Não foi possível carregar os comentários.');
            }
        }
    },
    
    // -------------------------------------------------------------------------
    // 8. FUNÇÕES DE RENDERIZAÇÃO
    // -------------------------------------------------------------------------
    render: {
        setLoadingState(container, isLoading) {
            if (isLoading) container.innerHTML = this.getLoadingHTML();
        },
        getLoadingHTML() { return '<p class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando...</p>'; },
        
        newsGrid(items, container) {
            container.innerHTML = items.map(item => {
                // Adapta para os dois tipos de objeto (API e Admin)
                const isApi = !!item.entry;
                const data = isApi ? item.entry : item;
                const videoId = isApi ? App.Api.fetch.toString.call(App.Api.fetch).split('(')[0].replace('function ', '') + '_' + item.trailer.url.split('v=')[1] : null;
                const id = isApi ? `video_${videoId}` : data.id;
                const type = isApi ? 'video' : 'article';
                const image = isApi ? data.images?.jpg?.large_image_url : data.image;
                
                return `
                    <a href="#" class="news-card" 
                       data-id="${id}" 
                       data-type="${type}"
                       data-title="${data.title}"
                       data-image="${image || App.config.PLACEHOLDER_IMG}"
                    >
                        <div class="news-card__image-container">
                            <img src="${image || App.config.PLACEHOLDER_IMG}" class="news-card__image" alt="${data.title}" onerror="this.src='${App.config.PLACEHOLDER_IMG}';">
                        </div>
                        <div class="news-card__content">
                            <span class="news-card__category">${isApi ? 'Vídeo' : data.category}</span>
                            <h3 class="news-card__title">${data.title}</h3>
                            ${!isApi ? `<p class="news-card__excerpt">${data.excerpt}</p>` : ''}
                            <div class="news-card__meta">
                                ${isApi 
                                    ? `<span><i class="fas fa-play-circle"></i> Abrir Vídeo</span>` 
                                    : `<span><i class="fas fa-user-edit"></i> ${data.author}</span><span><i class="fas fa-calendar-alt"></i> ${new Date(data.date).toLocaleDateString('pt-BR')}</span>`
                                }
                            </div>
                        </div>
                    </a>`;
            }).join('');
        },

        sidebarList(container, items) {
            container.innerHTML = items.map(item => `
                 <li class="ranking-item">
                    <a href="#">
                        <img src="${item.images?.jpg?.image_url || App.config.PLACEHOLDER_IMG}" class="ranking-item__img" alt="${item.title}" onerror="this.src='${App.config.PLACEHOLDER_IMG}';">
                        <div class="ranking-item__info">
                            <span class="ranking-item__title">${item.title_english || item.title}</span>
                            <div class="ranking-item__meta">
                                <span><i class="fas fa-star"></i> ${item.score || 'N/A'}</span>
                            </div>
                        </div>
                    </a>
                </li>
            `).join('');
        },

        videoModalLayout(data) {
            const videoId = data.id.split('_')[1];
            App.dom.modalMainContent.innerHTML = `
                <div class="video-player-container">
                    <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>`;
            App.dom.youtubeCommentsSection.style.display = 'block';
        },
        
        articleModalLayout(data) {
            App.dom.modalMainContent.innerHTML = `<div class="article-body-container">${data.content}</div>`;
            App.dom.youtubeCommentsSection.style.display = 'none';
        },

        comments(container, comments, emptyMessage) {
            if (!comments || comments.length === 0) {
                container.innerHTML = `<p class="status-message">${emptyMessage}</p>`;
                return;
            }
            container.innerHTML = comments.map(comment => `
                <div class="comment-card">
                    <img src="${comment.avatar || 'https://i.pravatar.cc/40?u=generic'}" alt="Avatar" class="comment-card__avatar">
                    <div class="comment-card__body">
                        <div>
                            <span class="comment-card__author">${comment.author}</span>
                            <span class="comment-card__date">${new Date(comment.date).toLocaleString('pt-BR')}</span>
                        </div>
                        <div class="comment-card__text">${comment.text}</div>
                    </div>
                </div>
            `).join('');
        }
    },
};

document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>